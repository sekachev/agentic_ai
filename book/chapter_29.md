// CHAPTER 29 ___________________________________________
// HUMAN-IN-THE-LOOP (HITL)

> СУТЬ:
ДОВЕРЯЙ, НО ПРОВЕРЯЙ.
Архитектурный паттерн, где агент должен получить одобрение
человека перед выполнением критически важных действий.

> ПОЧЕМУ ЭТО ВАЖНО (WHY IT MATTERS):
 1. Безопасность: Агент не удалит случайно базу данных.
 2. Репутация: Агент не отправит письмо с матом клиенту.
 3. Обучение: Правки человека улучшают понимание задачи агентом.

---

**ПОГРУЖЕНИЕ:**

Полная автономия — это цель, но путь к ней лежит через контроль. Особенно там, где есть деньги или личные данные.
**HITL** превращает агента из "черного ящика" в сотрудника, который приносит документы на подпись.

Режимы работы:
1.  **Copilot (Второй пилот):** Человек рулит, ИИ подсказывает.
2.  **Autopilot with Oversight (Автопилот с контролем):** ИИ рулит, человек следит и может перехватить штурвал.

В коде это реализуется через прерывание графа исполнения (Graph Interrupt). Агент доходит до ноды `wait_for_approval` и "замораживается", сохраняя все свое состояние (память, переменные). Как только человек нажимает "ОК", агент "размораживается" и продолжает с той же точки.

```text
       [ START ]
           |
           v
    +-------------+
    | Research    | (Агент ищет данные)
    +-------------+
           |
           v
    +-------------+
    | Draft Email | (Агент пишет черновик)
    +-------------+
           |
      STOP | WAIT
           v
    +------------------------+
    | HUMAN CHECKPOINT       |
    | "Отправить письмо?"    |
    | [YES] / [EDIT] / [NO]  |
    +------------------------+
           | (YES)
           v
    +-------------+
    | Send Email  | (Действие совершается)
    +-------------+
```

**Психология:**
HITL снимает страх перед внедрением ИИ. Бизнесу проще запустить агента, зная, что финальная кнопка все еще в руках человека.

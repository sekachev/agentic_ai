// CHAPTER 68 ___________________________________________
// ORCHESTRATION (0x44)

> СУТЬ:
ДИРИЖЕР ХАОСА.
Управление состоянием звонка в реальном времени.
Главная задача — корректно обрабатывать перебивания.

> ПОЧЕМУ ЭТО ВАЖНО (WHY IT MATTERS):
 1. Barge-in: Люди перебивают. Бот должен замолчать.
 2. Vapi/Twilio: Платформы, которые берут эту боль на себя.
 3. Websockets: HTTP слишком медленный для такого танго.

---

**ПОГРУЖЕНИЕ:**

Собрать пайплайн легко. Сделать так, чтобы он не бесил — сложно.
Главная проблема — **Перебивания** (Interruption).
Представьте: Бот начал длинную речь на 30 секунд. Вам стало скучно, и вы говорите: "Стоп, давай короче".
Плохой бот (без оркестратора) продолжит бубнить, пока не дочитает сгенерированный файл до конца. Вы будете кричать в пустоту.
Хороший оркестратор слушает канал *во время* своей речи. Если юзер издал звук, оркестратор рубит TTS на полуслове и очищает контекст LLM, чтобы она "забыла", что собиралась сказать.

```text
  Bot: "Today we have a special offer for..."
  User: "STOP!"
          |
          v
  [ ORCHESTRATOR ]
  1. Kill Audio Stream (Mute)
  2. Cancel LLM generation
  3. Send "User interrupted" to context
  4. Listen to User
```

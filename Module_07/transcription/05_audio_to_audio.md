# Audio-to-Audio: Мультимодальные модели

## От пайплайнов к мультимодальности

### Классическая архитектура (STT → LLM → TTS)

Традиционный подход к голосовому ассистенту:

```
Голос пользователя → STT → Текст → LLM → Текст ответа → TTS → Голос ответа
```

**Проблемы этого подхода:**

1. **Задержка** — каждый этап добавляет время:
   - STT: ~200-500мс
   - LLM: ~500-1000мс
   - TTS: ~500-1500мс
   - **Итого:** 1-3 секунды до первого ответа

2. **Надёжность** — цепочка зависимостей:
   - Если каждый компонент работает с вероятностью 99%
   - То вся система: 0.99 × 0.99 × 0.99 × 0.99 = **96%**
   - **4% звонков** будут падать!

3. **Потеря информации:**
   - STT теряет интонацию
   - Эмоциональная окраска не передается
   - LLM не знает, как именно говорил пользователь

### Мультимодальная архитектура (Native Audio)

Новый подход — **единая модель**:

```
Голос пользователя → Мультимодальная LLM → Голос ответа
```

**Преимущества:**

✅ **Скорость** — нет промежуточных преобразований  
✅ **Надёжность** — один компонент, один point of failure  
✅ **Понимание эмоций** — модель "слышит" интонацию  
✅ **Interruptions** — можно перебивать модель  
✅ **Логирование** — автоматическая транскрипция в обе стороны

## Gemini Live

### Характеристики

**Gemini Live (Flash/Pro)** — мультимодальная модель от Google:

- **Latency:** ~300-500мс до первого ответа
- **Цена:** $12 за миллион аудио-токенов (в 12.5 раз дешевле OpenAI)
- **Языки:** поддержка русского языка
- **Tool calling:** поддержка вызова функций

### Доступ через AI Studio

Интерфейс:
1. Зайти в **Google AI Studio**
2. Открыть вкладку **Live API**
3. Настроить **System Prompt**
4. Нажать кнопку микрофона — говорить!

**Тестирование:** можно бесплатно попробовать прямо в браузере.

### Пример диалога

```
Пользователь: "Привет!"
Gemini: "Привет! Как дела? Что случилось?"

Пользователь: "Расскажи какой-нибудь анекдот про женщин-программистов."
Gemini: "Почему женщины-программисты плохо справляются с работой? 
         Потому что они всегда пытаются исправить бесконечный цикл в отношениях."
```

**Интонация:** модель говорит живо, с паузами, естественными вариациями голоса.

### Ограничение: Half-Duplex

**Half-Duplex** (полудуплекс) — как рация:
- Либо модель говорит
- Либо пользователь говорит
- Не одновременно

Модель определяет Voice Activity и:
- Прекращает говорить, если пользователь начал
- Начинает слушать

**Full-Duplex** (будущее) — как телефон, оба могут говорить одновременно.

## Tool Calling в голосовых моделях

### Проблема больших System Prompts

Если у ассистента большая база знаний:
- Слишком длинный System Prompt → модель тормозит
- Внутренняя LLM в мультимодальной модели довольно скромная

### Решение: оркестрация агентов

**Архитектура с несколькими агентами:**

```
┌─────────────────┐
│  Главный агент  │ (определяет язык)
│  (Секретарь)    │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼──┐  ┌──▼───┐
│ RU   │  │ EE   │
│агент │  │агент │
└──┬───┘  └──┬───┘
   │         │
   ├──┬──┐   ├──┬──┐
   │  │  │   │  │  │
  ┌▼┐┌▼┐┌▼┐ ┌▼┐┌▼┐┌▼┐
  │М││Ч││X│ │М││Ч││X│
  │е││л││ │ │е││л││ │
  │р││е││ │ │р││е││ │
  │о││н││ │ │о││н││ │
  │п││ы││ │ │п││ы││ │
  └─┘└─┘└─┘ └─┘└─┘└─┘
```

**Пример для бизнес-клуба:**

1. **Секретарь** (первый контакт):
   - Определяет язык (русский/эстонский)
   - Передает управление специализированному агенту

2. **Русскоязычный агент:**
   - Субагент "Мероприятия" — Tool call к базе событий
   - Субагент "Члены клуба" — Tool call к базе участников

3. **Эстоноязычный агент:** аналогично

**Преимущества:**
- Каждый агент с чистым контекстом
- Узкая специализация = лучшее качество
- Легко масштабировать

### Демо: голосовой помощник Михаила Кылварта

```
Ассистент: "Tere! Michael Kõlvarta büroo. Miski keeles soovite rääkida?"
           (Здравствуйте! Приемная Михаила Кылварта. На каком языке вы хотите говорить?)

Пользователь: "Хотел бы говорить на русском."

Ассистент: "Здравствуйте, очень приятно. Меня зовут Мария, я голосовой помощник 
            Михаила Кылварта. Моя цель — собрать обратную связь от жителей Таллина. 
            Скажите, пожалуйста, как я могу к вам обращаться?"

Пользователь: "Меня зовут Николай."

Ассистент: "Очень приятно, Николай. О чём бы вы хотели рассказать сегодня?"

Пользователь: "Скамеек не хватает и большие проблемы с парковкой."

Ассистент: "Понимаю вас, Николай. Подскажите адрес или конкретные места, 
            чтобы мы знали, где это учесть."
```

**Задержка при переключении:** ~1 сек (загрузка нового агента), но дальше — как живой разговор.

## OpenAI Realtime API

**Первая мультимодальная модель:** OpenAI Realtime API (2023)

**Проблема:** цена — **150x** дороже текстовой модели!
- 3 минуты разговора "какая погода" = $20
- Непригодно для коммерческого использования

**Сейчас:** Google Gemini Live дешевле в 12.5 раз и доступнее.

## Будущее: Full-Duplex модели

### Nvidia Personaplex (январь 2026)

**Демонстрация:** полностью дуплексная связь.

Особенности:
- Можно говорить одновременно
- Модель поддерживает разговор, не прерываясь
- Естественные реакции ("ага", "угу", "понятно")
- Похоже на обычный телефонный разговор

```
Пользователь: "Хочешь услышать историю?"
Модель: "Да, давай!" (одновременно пользователь продолжает)
```

**Релиз:** 15 января 2026 (свежайшая технология на момент лекции)

### Характеристики будущего

В 2026-2027 году стандартом станет:
- **Full-Duplex** — двусторонняя одновременная связь
- **Low Latency** — ответы за миллисекунды
- **Emotion Understanding** — понимание эмоций из голоса
- **Context Awareness** — учет всего контекста разговора

## Практическое применение

### Когда нужны голосовые ассистенты?

**Главный use-case:** телефония.

Телефон остаётся основным каналом для важных коммуникаций:
- Звонки клиентам
- Техподдержка
- Напоминания
- Продажи

### Примеры задач

✅ **Подходит для голосовых ассистентов:**
- Call-центры (входящие звонки)
- Обзвон клиентов (исходящие)
- Запись на приём
- Опросы и анкетирование
- Уточнение информации

❌ **Пока не подходит:**
- Сложные переговоры
- Эмоционально чувствительные темы
- Случаи, требующие эмпатии

### Для личного использования

**Gemini в приложении:**
- Кнопка микрофона в мобильном приложении
- Можно задавать вопросы голосом
- Модель отвечает голосом
- Подходит для быстрых вопросов на ходу

**Ограничение:** многие предпочитают текст, так как:
- Быстрее прочитать, чем выслушать
- Удобнее в общественных местах
- Проще сохранить и найти информацию

## Сравнение подходов

| Характеристика | STT-LLM-TTS | Мультимодальная |
|----------------|-------------|-----------------|
| **Задержка** | 1-3 сек | 0.3-0.5 сек |
| **Надёжность** | 96% (4 компонента) | 99%+ (1 компонент) |
| **Эмоции** | ❌ Теряются | ✅ Сохраняются |
| **Tool Calling** | Сложно | ✅ Встроенно |
| **Цена** | Дешевле | Дороже (но падает) |
| **Логи** | Нужна доп. работа | ✅ Автоматически |

---

**Рекомендации:**

1. **Для экспериментов:** Google AI Studio → Live API (бесплатно)
2. **Для продакшна:** Gemini Live через API
3. **Следите за:** Nvidia Personaplex и другими full-duplex моделями
4. **Архитектура:** используйте оркестрацию агентов для сложной логики

# Телефония и голосовые приложения

## Введение

Телефон остается основным каналом для важных бизнес-коммуникаций. С появлением мультимодальных голосовых моделей становится возможным создание автоматизированных голосовых ассистентов, которые работают через обычные телефонные номера.

## Twilio: Телефонная инфраструктура

### Что такое Twilio

**Twilio** — платформа для программной работы с телефонией (VoIP, SIP, телефонные номера).

### Покупка номера

**Стоимость:**
- Аренда номера: ~€1-2 в месяц
- Входящие звонки: ~€0.02-0.04 за минуту
- Исходящие звонки: ~€0.03-0.05 за минуту

**Процесс:**
1. Регистрация на [twilio.com](https://twilio.com)
2. Phone Numbers → Buy a Number
3. Выбор страны и номера
4. Подтверждение покупки

### Настройка через API

Twilio полностью управляется через API:
- Маршрутизация звонков
- Запись разговоров
- Отправка SMS
- Конференц-связь
- IVR (Interactive Voice Response)

**Пример номера:** +372 6360 7076

## WebSocket для голосовых потоков

### Проблема

Для голосового ассистента нужно:
- Постоянное соединение (не обычный HTTP)
- Двусторонний обмен аудио в реальном времени
- Низкая задержка

### Решение: WebSocket

**WebSocket** — протокол для постоянного двустороннего соединения.

Архитектура:
```
Абонент → Twilio → WebSocket → VPS → Мультимодальная модель
                                  ↓
                              Обработка
                                  ↓
Абонент ← Twilio ← WebSocket ← VPS ← Ответ модели
```

**Сложности:**
- Нужен постоянно работающий сервер (VPS)
- Управление соединениями
- Обработка разрывов связи
- Синхронизация потоков

## Pipecat: Code-First решение

### Что такое Pipecat

**Pipecat** — open-source фреймворк для создания голосовых агентов с поддержкой:
- Twilio
- Мультимодальных моделей (Gemini Live, OpenAI Realtime)
- WebSocket управления
- Real-time обработки

### Возможности

✅ Поддержка Gemini Live  
✅ Поддержка Deepgram  
✅ Поддержка Google Flash  
✅ Автоматическое управление соединениями  
✅ Логирование и мониторинг

### Когда использовать

Подходит для:
- Разработчиков с опытом программирования
- Проектов, требующих полного контроля
- Кастомной логики и интеграций
- Open-source решений

## Vapi: No-Code решение

### Что такое Vapi

**Vapi** — платформа для создания голосовых агентов без кода.

**Главная идея:** визуальный конструктор вместо программирования.

### Быстрый старт

**Можно поднять голосового агента за 3 минуты:**

1. **Подключить Twilio:**
   - Скопировать номер телефона
   - Вставить Account SID и Auth Token
   - Vapi автоматически настроит маршрутизацию

2. **Создать ассистента:**
   - Выбрать языковую модель (GPT-4, Gemini и др.)
   - Выбрать голосовую модель (11Labs, Deepgram, Google)
   - Выбрать транскрибер (Whisper, Deepgram)

3. **Настроить System Prompt:**
   ```
   You are a customer support assistant for [Company Name].
   Your goal is to help users with their questions politely and efficiently.
   ```

4. **Готово!** Звоните на номер и тестируйте.

### Интерфейс Vapi

**Console** → **Assistants** → **Create Assistant**

Основные настройки:
- **Model:** языковая модель для логики
- **Voice:** TTS-провайдер и голос
- **Transcriber:** STT-провайдер
- **System Prompt:** инструкции для ассистента

### Готовые шаблоны

Vapi предлагает шаблоны:
- Customer Support
- Appointment Booking
- Lead Qualification
- Order Status
- General Assistant

Можно использовать как стартовую точку.

### Архитектура под капотом

Vapi решает все проблемы за вас:
- Управление WebSocket
- Подключение к провайдерам
- Voice Activity Detection
- Обработка ошибок
- Логирование разговоров

**Минус:** зависимость от платформы. Если Vapi упал — ваш сервис не работает.

### Стабильность

**Проблема:** много провайдеров = много точек отказа.

Пример из демо:
```
"Voice service not available" 
— провайдер 11Labs временно недоступен
```

Нужно:
- Иметь fallback-провайдеров
- Мониторить статус сервисов
- Тестировать регулярно

### Пример использования

**Создание ассистента:**
1. Выбираем шаблон "Customer Support"
2. Меняем System Prompt на свой кейс
3. Выбираем голос (например, из библиотеки 11Labs)
4. Выбираем транскрибер (Deepgram для английского)
5. Привязываем к Twilio-номеру

**Тестирование:**
- Звоним на номер
- Ассистент приветствует
- Задаем вопросы
- Проверяем логи в консоли Vapi

## Сравнение подходов

| Характеристика | Pipecat | Vapi |
|----------------|---------|------|
| **Сложность** | Высокая (код) | Низкая (no-code) |
| **Контроль** | Полный | Ограниченный |
| **Скорость запуска** | Дни-недели | 3 минуты |
| **Гибкость** | Максимальная | Средняя |
| **Зависимость** | От вашего VPS | От Vapi |
| **Цена** | VPS + API | Подписка Vapi + API |
| **Open Source** | ✅ Да | ❌ Нет |

## Экономика голосовых ботов

### Стоимость живого оператора

**Месячные затраты на оператора call-центра:**
- Зарплата: €1000-2000
- Рабочее место: €100-200
- Оборудование: €50-100
- Обучение и менеджмент: €200-300

**Итого:** ~€1500-2500/месяц на одного оператора

### Стоимость голосового бота

**Twilio:**
- Номер: €2/месяц
- 1000 минут входящих: €30-40

**Мультимодальная модель (Gemini Live):**
- 1000 минут: ~€30-100 (зависит от сложности)

**VPS/Vapi:**
- €20-50/месяц

**Итого:** ~€80-200/месяц за НЕОГРАНИЧЕННОЕ количество одновременных звонков

### ROI

Бот окупается, если:
- Более 50-100 звонков в день
- Типовые вопросы (FAQ, запись, статус заказа)
- Круглосуточная доступность важна

## Практические кейсы

### 1. Техподдержка первой линии

**Задача:** отвечать на частые вопросы, эскалировать сложные.

**Реализация:**
- Vapi + Knowledge Base через Tool Calling
- Если бот не знает → перевод на человека
- Логирование всех разговоров

### 2. Запись на приём

**Задача:** записать клиента к врачу/в салон/к специалисту.

**Реализация:**
- Интеграция с календарем (Google Calendar API)
- Tool call для поиска свободных слотов
- Подтверждение через SMS

### 3. Опросы и обратная связь

**Задача:** собрать отзывы клиентов после покупки.

**Реализация:**
- Исходящий обзвон через Twilio
- Короткий скрипт вопросов
- Сохранение в базу данных

### 4. Квалификация лидов

**Задача:** определить, насколько клиент готов к покупке.

**Реализация:**
- Вопросы про бюджет, сроки, потребности
- CRM-интеграция
- Автоматическая передача менеджеру

## Рекомендации

### Начните с Vapi

Для первых экспериментов:
1. Зарегистрируйтесь в **Twilio** (есть trial credits)
2. Зарегистрируйтесь в **Vapi**
3. Подключите Twilio к Vapi
4. Создайте простого ассистента
5. Позвоните себе и протестируйте

**Время:** 10-15 минут от нуля до работающего ассистента.

### Переходите на Pipecat

Когда нужно:
- Сложная логика с ветвлениями
- Интеграция с внутренними системами
- Полный контроль над процессом
- Open-source решение

### Обязательно

✅ Логируйте все разговоры (транскрипты)  
✅ Мониторьте качество ответов  
✅ Имейте fallback на человека  
✅ Информируйте клиентов, что это бот  
✅ Тестируйте edge-cases

## Будущее телефонии с ИИ

### 2026-2027

Ожидается:
- **Full-duplex модели** — естественный разговор
- **Эмоциональный интеллект** — распознавание настроения
- **Мультиязычность** — автоперевод в реальном времени
- **Снижение цен** — в 5-10 раз

### Замена операторов

Прогноз:
- 70-80% звонков в call-центры — автоматизация
- Операторы остаются для сложных/эскалированных случаев
- Появление новой профессии: "голосовой UX-дизайнер"

---

**Практическое задание:**

1. Зарегистрируйтесь в Twilio (trial аккаунт)
2. Зарегистрируйтесь в Vapi
3. Подключите Twilio номер
4. Создайте простого ассистента (Customer Support)
5. Позвоните себе и проведите тестовый диалог
6. Изучите логи в консоли Vapi
7. *(Опционально)* Попробуйте добавить Tool Function
